<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>게시물 조회</title>
  <link rel="stylesheet" th:href="@{/css/read.css}" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Black+Han+Sans|Nanum+Brush+Script"
        rel="stylesheet">
</head>

<div class="readArea">
  <div class="buttonArea">
    <a href="/board/list" class="backBtn">목록</a>
    <a th:href="@{/board/modify(bno=${board.bno})}" class="updateBtn" onclick="">수정</a>
    <a th:href="@{/board/remove(bno=${board.bno})}" class="deleteBtn">삭제</a>
  </div>
  <div id="editor_iframe_wrapper">
    <iframe id="editor_iframe" th:src="@{http://localhost:8080/board/editor(bno=${board.bno})}"
            scrolling="no"></iframe>
  </div>
  <div class="upload_iframe_wrapper">
      <iframe id="uploader_iframe"
              th:src="@{http://localhost:8080/board/uploader(bno=${board.bno})}"
              scrolling="no"></iframe>
  </div>
</div>
</html>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script th:src="@{/js/read.js}"></script>
<script th:inline="javascript">
  document.querySelector(".deleteBtn").addEventListener("click", function (e) {
    if (confirm("삭제하시겠습니까?")) {
      axios.post(`/board/remove?bno=${[[${board.bno}]]}`)
      .then((response) => {
        alert("삭제되었습니다.");
        location.href = "/board/list";
      })
      .catch((error) => {
        console.log(`/board/remove/${[[${board.bno}]]}`)
        console.log(error);
      });
    }
    e.preventDefault();
  });

  adjustIframeHeight('editor_iframe');
  adjustIframeHeight('uploader_iframe');

  function adjustIframeHeight(iframeId) {
    var iframe = document.getElementById(iframeId);
    iframe.onload = function () {
      var iframeBody = iframe.contentWindow.document.body;
      var height = calculateTotalHeight(iframeBody);
      console.log(iframeId, height)
      iframe.style.height = height + 'px';
    };
  }

  function calculateTotalHeight(element) {
    var totalHeight = 0;
    for (var child of element.childNodes) {
      if (child.offsetHeight) {
        totalHeight += child.offsetHeight;
      }
    }
    return Number(totalHeight) + 40;
  }


</script>