function uploadAjaxOnprogressStart(a,d){KEDITORTOP.G_CURRKEDITOR.xhr_onprogress=new XMLHttpRequest;var c=KEDITORTOP.G_CURRKEDITOR.xhr_onprogress,b=KEDITORTOP.G_CURRKEDITOR.imageFileInfo.isMulti;c.upload.onprogress=function(a){try{if(!b){var e=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(a.loaded/a.total*100),c=document.getElementById("keditor_loading");c&&c.childNodes&&(c.childNodes[1].nodeValue=" Uploading... "+e+"%")}}catch(d){loading_image_show(!1)}};c.onload=function(){if(c){var a;200==c.status?(a=
c.responseText,a=KEDITORTOP.RAONKEDITOR.util.parseDataFromServer(a),0==a.indexOf("[OK]")?(a=a.replace("[OK]",""),a=KEDITORTOP.RAONKEDITOR.util.makeDecryptReponseMessage(a),a=web_url_remove_char(a)):0==a.indexOf("[FAIL]")&&(a=a.replace("[FAIL]",""),a="[FAIL]"+KEDITORTOP.RAONKEDITOR.util.makeDecryptReponseMessage(a))):a="[FAIL]File Upload Error";c=null;b||loading_image_show(!1);d(a)}};c.onerror=function(){c=null;b||loading_image_show(!1);d("[FAIL]File Upload Error")};var e=new FormData;a.formData&&
0<a.formData.length&&a.formData.each(function(a,c){e.append(a,c)});if(a.fileObj){var g=a.fileObj[0]?a.fileObj[0]:a.fileObj,h="1"==KEDITORTOP.G_CURRKEDITOR._config.uploadFileNameEncoding?encodeURIComponent(g.name):g.name;e.append(a.fileID,g,h)}c.open("POST",a.handlerUrl,!0);c.send(e)}
function uploadAjaxOnprogressCancel(){if(KEDITORTOP.G_CURRKEDITOR.xhr_onprogress)try{KEDITORTOP.G_CURRKEDITOR.xhr_onprogress.abort(),KEDITORTOP.G_CURRKEDITOR.xhr_onprogress=null}catch(a){KEDITORTOP&&KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&console.log(a)}}
function setDragAndDropEvent(a){a=document.getElementById(a);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"dragenter",upload_DragEnter);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"dragover",upload_DragOver);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"drop",upload_Drop);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"click",upload_Drop_zone_click);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"dragleave",upload_DragLeave)}
function upload_DragEnter(a){"1"==KEDITORTOP.G_CURRKEDITOR._config.useKManager&&useManagerDropZone(a);try{a.stopPropagation(),a.preventDefault()}catch(d){KEDITORTOP.RAONKEDITOR.util.cancelEvent(d)}}
function upload_DragOver(a){if("0"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){var d="drop_zone";a.currentTarget&&a.currentTarget.getAttribute("id")&&(d=a.currentTarget.getAttribute("id"));document.getElementById(d).style.border="solid 1px gray";document.getElementById(d).style.backgroundColor="#EDEDED"}try{a.stopPropagation(),a.preventDefault()}catch(c){KEDITORTOP.RAONKEDITOR.util.cancelEvent(c)}}
function upload_DragLeave(a){if("0"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){var d="drop_zone";a.currentTarget&&a.currentTarget.getAttribute("id")&&(d=a.currentTarget.getAttribute("id"));document.getElementById(d).style.border="dashed 1px gray";document.getElementById(d).style.backgroundColor="#FFFFFF"}try{a.stopPropagation(),a.preventDefault()}catch(c){KEDITORTOP.RAONKEDITOR.util.cancelEvent(c)}}
function upload_Drop(a){if("0"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){var d="drop_zone";a.currentTarget&&a.currentTarget.getAttribute("id")&&(d=a.currentTarget.getAttribute("id"));document.getElementById(d).style.border="dashed 1px gray";document.getElementById(d).style.backgroundColor="#FFFFFF";d="";null!=document.getElementById("drop_zone_uploadtype")&&(d=document.getElementById("drop_zone_uploadtype").value);a.currentTarget&&a.currentTarget.getAttribute("drop_zone_uploadtype")&&(d=a.currentTarget.getAttribute("drop_zone_uploadtype"));
var c="file_text";a.currentTarget&&a.currentTarget.getAttribute("file_text")&&(c=a.currentTarget.getAttribute("file_text"));G_dragDropFileObj=a.dataTransfer.files;var b={files:a.dataTransfer.files};switch(d){default:document.getElementById(c).value=a.dataTransfer.files[0].name,document.getElementById(c).setAttribute("value",a.dataTransfer.files[0].name)}fileOnchange(b,d,a)}KEDITORTOP.RAONKEDITOR.util.cancelEvent(a)}
function upload_Drop_zone_click(a){var d="Filedata",c="",b=!1;null!=document.getElementById("drop_zone_uploadtype")&&(c=document.getElementById("drop_zone_uploadtype").value);a.currentTarget&&a.currentTarget.getAttribute("drop_zone_uploadtype")&&(c=a.currentTarget.getAttribute("drop_zone_uploadtype"),d+="_"+c,b=null!=a.currentTarget.getAttribute("useOnlyHtml5")?!0:!1);null==document.getElementById(d)&&(d=KEDITORTOP.G_CURRKEDITOR._config.fileFieldID);if("1"==KEDITORTOP.G_CURRKEDITOR._config.useKManager&&
0==b){a=null;switch(c){case "image":case "input_image":a=1;"1"==KEDITORTOP.G_CURRKEDITOR._config.insertMultiImage&&"image"==c&&null==elemModify&&(a=0);a={agentCmd:"KC01",maxTotalCount:a,maxOneFileSize:0,limitOrAllow:0,limitOrAllowExt:"",getSize:1,isIE:KEDITORTOP.RAONKEDITOR.browser.ie,callBack:function(a){for(var b={files:[]},d=a.length,f=0;f<d;f++)b.files.push({detect:a[f].detect,name:a[f].path.substring(a[f].path.lastIndexOf("\\")+1),size:a[f].size,path:a[f].path,width:a[f].width,height:a[f].height});
fileOnchangeAfter(b,c)}};break;case "video":case "video_media":case "poster_media":a={agentCmd:"KC01",maxTotalCount:1,maxOneFileSize:0,limitOrAllow:0,limitOrAllowExt:"",getSize:0,isIE:KEDITORTOP.RAONKEDITOR.browser.ie,callBack:function(a){var b={files:[]};b.files.push({detect:a[0].detect,name:a[0].path.substring(a[0].path.lastIndexOf("\\")+1),size:a[0].size,path:a[0].path});fileOnchangeAfter(b,c,"drop_zone_"+c)}};break;case "insert_file":case "hyperlink_image":case "flash":case "media":case "m_image":case "doc_bg_image":case "cell_bg_image":case "p_table_bg_image":case "table_bg_image":a=
{agentCmd:"KC01",maxTotalCount:1,maxOneFileSize:0,limitOrAllow:0,limitOrAllowExt:"",getSize:0,isIE:KEDITORTOP.RAONKEDITOR.browser.ie,callBack:function(a){var b={files:[]};b.files.push({detect:a[0].detect,name:a[0].path.substring(a[0].path.lastIndexOf("\\")+1),size:a[0].size,path:a[0].path});fileOnchangeAfter(b,c,"drop_zone")}}}-1<c.indexOf("image")&&(a.filter="images|*.jpg;*.jpeg;*.png;*.gif;*.bmp;*.tif;*.tiff");LayerWin.agentFileSelect(a)}else document.getElementById(d).click()}
function useManagerDropZone(a,d){var c;c=KEDITORTOP.G_CURRKEDITOR;a.currentTarget&&(currentTargetID=a.currentTarget.id);var b=a.clientX,e=a.clientY,g=1;void 0!=window.devicePixelRatio?g=window.devicePixelRatio:void 0!=screen.deviceXDPI&&void 0!=screen.logicalXDPI&&screen.deviceXDPI!=screen.logicalXDPI&&(g=1*screen.deviceXDPI/screen.logicalXDPI);1!=g&&(b*=g,e*=g);var h=a.screenX-b,f=a.screenY-e;if("1"==c._config.useKManager){var b=function(a){var b;96==c.osDPI?b=100:120==c.osDPI?b=125:144==c.osDPI&&
(b=150);var d=1,d=1*g/(1*b/100);a.editorRectW=l/g;a.editorRectH=k/g;a.dropZoneX=h/g;a.dropZoneY=f/g;1!=d&&(a.editorRectW=l*d,a.editorRectH=k*d,a.dropZoneX=h*d,a.dropZoneY=f*d);return a},l=0,k=0;if("1"==c._config.dragAndDropMode&&void 0!=KEDITORTOP.screenX&&void 0!=KEDITORTOP.outerWidth)h=KEDITORTOP.screenX*g,f=KEDITORTOP.screenY*g,l=KEDITORTOP.outerWidth*g,k=KEDITORTOP.outerHeight*g,96<c.osDPI&&(b=b({editorRectW:l,editorRectH:k,dropZoneX:h,dropZoneY:f}),h=b.dropZoneX,f=b.dropZoneY,l=b.editorRectW,
k=b.editorRectH);else{if(KEDITORTOP.RAONKEDITOR.browser.chrome||KEDITORTOP.RAONKEDITOR.browser.opera)f=window.screenY+f;window.screenX>=h?(KEDITORTOP.RAONKEDITOR.browser.ie&&1>g||(h+=window.screenX),KEDITORTOP.RAONKEDITOR.browser.chrome&&(h+=5)):5>=window.screenX&&(KEDITORTOP.RAONKEDITOR.browser.chrome||KEDITORTOP.RAONKEDITOR.browser.opera)&&(h=window.screenX+h,KEDITORTOP.RAONKEDITOR.browser.chrome&&(h+=5));e=null;e=null==d||void 0==d?document.getElementById("drop_zone"):d;e=KEDITORTOP.RAONKEDITOR.util.getClientRect(e);
l=e.right-e.left;k=e.bottom-e.top;1!=g&&(l*=g,k*=g);d?(0>d.className.indexOf("raonkdropzone_over")&&(d.className=d.className.replace("raonkdropzone","raonkdropzone_over")),h+=e.left*g,f+=e.top*g):(h+=e.left,f+=e.top);96<c.osDPI&&"Windows"==KEDITORTOP.RAONKEDITOR.UserAgent.os.name&&"10"==KEDITORTOP.RAONKEDITOR.UserAgent.os.version&&KEDITORTOP.RAONKEDITOR.browser.ie&&(b=b({editorRectW:l,editorRectH:k,dropZoneX:h,dropZoneY:f}),h=b.dropZoneX,f=b.dropZoneY,l=b.editorRectW,k=b.editorRectH)}b=[["kcmd","KC02"]];
b.push(["k16",c._config.managerLang]);b.push(["k17",0]);b.push(["s01",encodeURIComponent("*.*")]);e=1;"1"==KEDITORTOP.G_CURRKEDITOR._config.insertMultiImage&&(e=0);b.push(["s02",e+""]);b.push(["s03","0"]);b.push(["s04","0"]);b.push(["s05",0]);b.push(["s06",0]);b.push(["s07",encodeURIComponent("")]);e=h+KEDITORTOP.RAONKSolution.Agent.vertical;e+=f+KEDITORTOP.RAONKSolution.Agent.vertical;e+=l+KEDITORTOP.RAONKSolution.Agent.vertical;e+=k+KEDITORTOP.RAONKSolution.Agent.vertical;e+=c._config.dropZoneTransparency;
b.push(["kp1",e]);b.push(["kp2",1]);e={};!0===KEDITORTOP.RAONKEDITOR.browser.ie&&(e.fromie=1);for(data in e){b.push(["s11",e]);break}var m=KEditorLayerWin.setManagerParam("{}",b),m=KEDITORTOP.RAONKSolution.Agent.makeEncryptManagerParam(m),p=function(a){KEDITORTOP.RAONKEDITOR.IsCreatedDropZone=!1;d&&(d.className=d.className.substring(0,d.className.length-5));a=KEDITORTOP.RAONKSolution.Agent.parseRtn(a);var b=a.code;a=a.valueArr;if(1E3==b){var b={files:[]},c=null,e=null;null!=document.getElementById("drop_zone_uploadtype")&&
(c=document.getElementById("drop_zone_uploadtype").value);null!=document.getElementById(currentTargetID)&&null!=document.getElementById(currentTargetID).getAttribute("drop_zone_uploadtype")&&(e=document.getElementById(currentTargetID).getAttribute("drop_zone_uploadtype"));for(var f=!1,g,h=a.length,l=0;l<h;l++){var k=a[l].split(KEDITORTOP.RAONKSolution.Agent.formfeed);"2"==k[0]&&(f=!0,g=l);var n={detect:k[0],path:k[1],name:k[1].substring(k[1].lastIndexOf("\\")+1),size:k[2],width:0,height:0};void 0!=
k[3]&&(n.width=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(k[3]),n.height=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(k[4]));b.files.push(n)}if(f&&(alert(b.files[g].path),1==b.files.length))return;null==e?fileOnchangeAfter(b,c,"drop_zone"):fileOnchangeAfter(b,e,"drop_zone_"+e)}else 2E3!=b&&2001==b&&KEditorLayerWin.sendMessageToAgent(m,p,null,!0)},b=!1;KEDITORTOP.RAONKEDITOR.browser.chrome&&null==a.fromElement&&null==a.relatedTarget&&(b=!0);KEDITORTOP.RAONKEDITOR.IsCreatedDropZone&&c.lastAgentCmd==m||0!=b||
(KEDITORTOP.RAONKEDITOR.IsCreatedDropZone=!0,c.lastAgentCmd=m,KEditorLayerWin.sendMessageToAgent(m,p,null,!0))}};
