function SplitPage(){this.splitPageDocument=this.splitPageWindow=this.pageDocument=this.pageWindow=null;this.page=[];this.pdfStyle=this.onComplete=null;this.isDebugger=this.logging=!1;this.defaultStyle=this.currentPageSize=null;this.util={isActiveScrollbarY:function(a,b){var c=!1;if(b){var d=b.rectCheckNode,f=b._this,f=a.getBoundingClientRect().bottom-parseInt(f.defaultStyle.paddingBottom,10);d.getBoundingClientRect().bottom>f&&(c=!0)}else c=a.scrollHeight>a.offsetHeight;return c},isPageBreakNode:function(a){var b=
!1;a=a.outerHTML;var c=a.indexOf(">");a=a.substring(0,c+1);-1<a.toLowerCase().indexOf("break-after: page")&&(b=!0);return b},insertFirstChild:function(a,b){0==a.hasChildNodes()?a.appendChild(b):a.insertBefore(b,a.firstChild)},isCheckLastChild:function(a){var b=!0;-1<",BR,TABLE,P,".indexOf(","+a.tagName+",")&&(b=!1);return b},isCheckPagebreaContainer:function(a){var b=!0;-1<",TABLE,".indexOf(","+a+",")&&(b=!1);return b},insertAfter:function(a,b){var c=a.parentNode;c&&(a.nextSibling?c.insertBefore(b,
a.nextSibling):c.appendChild(b))},getInnerRect:function(a){var b=document.createElement("custom_div");b.style.display="flex";b.style.width="100%";b.style.height="100%";a.appendChild(b);var c=b.getBoundingClientRect();a.removeChild(b);return c},getPageSize:function(a){var b={width:0,height:0};"a4"==a&&(b.width="793.7px",b.height="1122.5px");return b}};this.init=function(a){try{if("string"==typeof a.html){var b=a.html,c=this,d=document.createElement("iframe");1==c.isDebugger?(top.document.body.appendChild(d),
d.style.opacity=1,d.style.top="0px",d.style.height="1200px",hideProcessingBackground()):(document.body.appendChild(d),d.style.opacity=0);d.style.position="absolute";d.style.width="100%";this.splitPageWindow=d.contentWindow;this.splitPageDocument=this.splitPageWindow.document;window.splitPageFrameLoaded=function(){try{c.setPdfStyle(a);c.splitPageDocument.body.innerHTML="<div></div>";delete window.splitPageFrameLoaded;var d=document.createElement("iframe");document.body.appendChild(d);d.style.opacity=
0;d.style.position="absolute";d.style.width="100%";c.pageWindow=d.contentWindow;c.pageDocument=c.pageWindow.document;window.pageFrameLoaded=function(){try{c.removeNodes(),c.adjustNodeBeforeSplit(),c.imageConvertBase64(a,function(){c.checkAndMakePage()}),delete window.pageFrameLoaded}catch(b){c.onComplete(b)}};b+='<script type="text/javascript">document.body.onload = function() { parent.pageFrameLoaded(); }\x3c/script>';c.pageDocument.open();c.pageDocument.write(b);c.pageDocument.close()}catch(f){c.onComplete(f)}};
d='<html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0">';d+="</head><body></body></html>";d=1==c.isDebugger?d+'<script type="text/javascript">document.body.onload = function() { parent.KEDITORTOP.G_CURRKEDITOR._FRAMEWIN.splitPageFrameLoaded(); }\x3c/script>':d+'<script type="text/javascript">document.body.onload = function() { parent.splitPageFrameLoaded(); }\x3c/script>';d=b.substring(0,b.indexOf("<html"))+
d;this.splitPageDocument.open();this.splitPageDocument.write(d);this.splitPageDocument.close()}}catch(f){this.onComplete(f)}};this.clear=function(){this.pageDocument.body.innerHTML="";try{this.pdfStyle.parentNode.removeChild(this.pdfStyle),this.pdfStyle=null}catch(a){KEDITORTOP&&KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&window&&window.console&&console.log(a)}try{var b=this.pageWindow.frameElement;b.parentNode.removeChild(b)}catch(c){KEDITORTOP&&KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&
window&&window.console&&console.log(c)}try{for(var d=this.page.length-1;0<=d;d--)this.page[d].parentNode.removeChild(this.page[d]);this.page=[]}catch(f){KEDITORTOP&&KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&window&&window.console&&console.log(f)}try{var e=this.splitPageWindow.frameElement;e.parentNode.removeChild(e)}catch(h){KEDITORTOP&&KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&window&&window.console&&console.log(h)}};this.createPage=function(){var a=this.splitPageDocument.createElement("div");
a.className="raon_pdf_page";this.splitPageDocument.body.firstChild.appendChild(a);this.page.push(a)};this.getCurrentPage=function(){return this.page[this.page.length-1]};this.getPrePage=function(){return this.page[this.page.length-2]};this.splitConfig={cloneAttrName:"clone_index",splitIndex:-1,pareNodeObjArr:[]};this.initSplitConfig=function(){this.splitConfig.splitIndex=-1;this.splitConfig.pareNodeObjArr=[]};this.splitNode=function(a,b,c){if(!c.forceStop){var d=this.getPrePage(),f=null,e=a.getAttribute(this.splitConfig.cloneAttrName);
null!=e&&(e=parseInt(e,10),f=this.splitConfig.pareNodeObjArr[e])&&(f=f.nextNode);null==f&&(a.setAttribute(this.splitConfig.cloneAttrName,++this.splitConfig.splitIndex),f=a.cloneNode(!1),this.util.insertFirstChild(b,f),this.splitConfig.pareNodeObjArr[this.splitConfig.splitIndex]={preNode:a,nextNode:f,nextNodeParent:b},this.modifyNodes[a.tagName]&&(this.modifyNodes[a.tagName].checked=!0,this.modifyNodes[a.tagName].nodeIndex.push(this.splitConfig.splitIndex),this.modifyNodes[a.tagName].preModify&&this.modifyNodes[a.tagName].preModify(this,
a,c)));if(1==this.util.isCheckLastChild(a))for(;a.lastChild&&1!=c.forceStop;){if(1==c.pageBreak){if(this.util.isPageBreakNode(a))break}else if(0==this.util.isActiveScrollbarY(d))break;b=a.lastChild;1==b.nodeType?this.splitNode(b,f,c):this.util.insertFirstChild(f,b)}1==c.pageBreak&&this.util.isPageBreakNode(a)?(c.forceStop=!0,f.parentNode.removeChild(f),a.parentNode.removeChild(a)):(this.modifyNodes[a.tagName]&&this.modifyNodes[a.tagName].checked&&this.modifyNodes[a.tagName].split&&this.modifyNodes[a.tagName].split(this,
a,c),b=a.parentNode,null==a.lastChild&&b&&(this.modifyNodes[a.tagName]&&1==this.modifyNodes[a.tagName].checked&&(e=a.getAttribute(this.splitConfig.cloneAttrName),e=parseInt(e,10),e=this.modifyNodes[a.tagName].nodeIndex.indexOf(e),this.modifyNodes[a.tagName].nodeIndex.splice(e,1)),b.removeChild(a),1==c.pageBreak?this.util.isPageBreakNode(a)||this.splitNode(b,f.parentNode,c):0!=this.util.isActiveScrollbarY(d)&&this.splitNode(b,f.parentNode,c)))}};this.modifyNodes={P:{nodeIndex:[],split:function(a,b,
c){b.parentNode.removeChild(b)},preModify:function(a,b,c){c=b.cloneNode(!0);b=b.getAttribute(a.splitConfig.cloneAttrName);b=parseInt(b,10);var d=a.splitConfig.pareNodeObjArr[b].nextNode;d.parentNode.insertBefore(c,d);d.parentNode.removeChild(d);a.splitConfig.pareNodeObjArr[b].nextNode=c;a.splitConfig.pareNodeObjArr[b].nextNodeParent=c.parentNode}},OL:{checked:!1,nodeIndex:[],modify:function(a){for(var b=this.nodeIndex.length,c=0;c<b;c++){for(var d=a.splitConfig.pareNodeObjArr[this.nodeIndex[c]],f=
d.nextNode,e=0,d=d.preNode.childNodes,h=d.length,l=0;l<h;l++){var g=d[l];"LI"==g.tagName&&e++}for(var m=null,d=f.childNodes,h=d.length,l=0;l<h;l++)if(g=d[l],"LI"==g.tagName){m=g;break}m&&(m.value=++e)}}},LI:{checked:!1,nodeIndex:[],modify:function(a){for(var b=this.nodeIndex.length,c=0;c<b;c++){var d=a.splitConfig.pareNodeObjArr[this.nodeIndex[c]].nextNode;d.style.listStyle="none";--d.value}}},TABLE:{checked:!1,nodeIndex:[],preModifyAttr:"pre_modified",modifyMerge:{index:-1,attr:"raon_m_index",data:[],
setAttr:function(a){var b=a.getAttribute(this.attr),b=null==b?this.index+"":b+(","+this.index);a.setAttribute(this.attr,b)}},modify:function(a){},preModify:function(a,b,c){if(1==c.pageBreak){c=b.getAttribute(a.splitConfig.cloneAttrName);c=parseInt(c,10);b=b.cloneNode(!0);var d=a.splitConfig.pareNodeObjArr[c]}else{c=a.getPrePage();var f=b.style.display;b.style.display="none";d=!1;0==a.util.isActiveScrollbarY(c)&&(d=!0);b.style.display=f;c=b.getAttribute(a.splitConfig.cloneAttrName);c=parseInt(c,10);
if(d){b.setAttribute(this.preModifyAttr,1);for(var e=[],d=b.rows,h=d.length,f=0;f<h;f++){e.push([]);for(var l=d[f].cells,g=l.length,m=0;m<g;m++){var n=l[m],p=a.util.getInnerRect(n);e[f].push({w:p.width,h:p.height});if(1<n.rowSpan){this.modifyMerge.index++;n={ci:n.cellIndex,rs:n.rowSpan,cell:n};this.modifyMerge.data[this.modifyMerge.index]=n;for(var n=f+n.rs,k=f;k<n;k++)this.modifyMerge.setAttr(d[k])}}}b.style.height="";for(f=0;f<h;f++)for(l=d[f].cells,g=l.length,m=0;m<g;m++)n=l[m],n.style.width=e[f][m].w+
"px",n.style.height=e[f][m].h+"px"}d=a.getCurrentPage();e=a.util.getInnerRect(d);l=d.getBoundingClientRect();d=b.rows;h=d.length;for(f=h-1;0<=f;f--)for(k=d[f],h=!0;;)if(p=k.getBoundingClientRect(),p.height>e.height){m=k.rowIndex;n=p.height-l.height+30;h&&(n+=p.top);h=k.cloneNode(!0);a.util.insertAfter(k,h);p=k.cells[k.cells.length-1].getBoundingClientRect();g=h.cells[h.cells.length-1].getBoundingClientRect();if(0==isSameRect(p.right,g.right))for(var r=m-1;0<=r;r--)if(m=d[r]){for(var q=m.cells,u=q.length,
m=0;m<u;m++){var t=q[m];1<t.rowSpan&&(t.rowSpan+=1)}if(isSameRect(p.right,g.right))break}else break;m=[];r=k.cells;q=r.length;for(k=0;k<q;k++)if(g=r[k],u=parseFloat(g.style.height)-n,g.style.height=u+"px",t=null,g.firstChild&&"DIV"==g.firstChild.tagName&&"1"==g.firstChild.getAttribute("split_div")&&(g.firstChild.style.overflowY="auto",g.firstChild.style.height=u+"px",t=g.firstChild),p=getClientRect(g),p.height>u){null==t&&(t=a.splitPageDocument.createElement("div"),t.style.height=parseInt(u,10)+"px",
t.style.overflowX="hidden",t.style.overflowY="auto",t.innerHTML=g.innerHTML,g.innerHTML="",g.appendChild(t));for(g=[];a.util.isActiveScrollbarY(t);){var v=t.lastChild;if(3==v.nodeType&&/./.test(v.nodeValue)){var w=a.splitPageDocument.createElement("span");v.parentNode.insertBefore(w,v);w.appendChild(v);v=w}if(getClientRect(v).height>u)break;else w=v.cloneNode(!0),g.push(w),v.parentNode.removeChild(v)}t.style.overflowY="hidden";0<g.length&&m.push({rect:p,childArr:g})}r=h.cells;q=r.length;for(k=0;k<
q;k++)if(g=r[k],g.style.height=n+"px",g.innerHTML="",0<m.length)for(u=0;u<m.length;u++)if(t=m[u].rect,p=getClientRect(g),isSameRect(t.left,p.left)&&isSameRect(t.right,p.right,1))for(p=m[k].childArr.length-1;0<=p;p--)g.appendChild(m[u].childArr[p]);if(getClientRect(h).height>n)for(q=r.length,k=0;k<q;k++)n=r[k],p=a.util.getInnerRect(n),n.style.height=p.height+"px";k=h;h=!1}else break;b=b.cloneNode(!0);d=a.splitConfig.pareNodeObjArr[c]}d=d.nextNode;d.parentNode.insertBefore(b,d);d.parentNode.removeChild(d);
a.splitConfig.pareNodeObjArr[c].nextNode=b;a.splitConfig.pareNodeObjArr[c].nextNodeParent=b.parentNode},split:function(a,b,c){if(1==c.pageBreak)c=b.getAttribute(a.splitConfig.cloneAttrName),parseInt(c,10),c=this.nodeIndex[0],c=a.splitConfig.pareNodeObjArr[c],c=c.nextNode,b.parentNode.removeChild(b);else if(b.getAttribute(this.preModifyAttr)){var d=a.getPrePage();c=b.getAttribute(a.splitConfig.cloneAttrName);c=parseInt(c,10);c=a.splitConfig.pareNodeObjArr[c];c=c.nextNode;for(var f=b.rows,e=f.length,
h=0,l=[],g=null,m=e-1;0<=m;m--){var n=f[m];h++;g=b.rows[m-1];n.style.visibility="collapse";for(var p=n.cells,k=p.length,e=0;e<k;e++){var r=p[e];r.style.border="none"}if(KEDITORTOP.RAONKEDITOR.browser.ie||KEDITORTOP.RAONKEDITOR.browser.gecko)n.style.display="none",l.push(n);e=null;g&&(e={rectCheckNode:g,_this:a});if(0==a.util.isActiveScrollbarY(d,e))break}if(KEDITORTOP.RAONKEDITOR.browser.ie||KEDITORTOP.RAONKEDITOR.browser.gecko)for(e=0;e<l.length;e++)l[e].style.display="";a=[];if(g&&(e=g.getAttribute(this.modifyMerge.attr)))for(r=
e.split(","),l=r.length,e=0;e<l;e++){b=parseInt(r[e],10);d=this.modifyMerge.data[b];b=GetParentbyTagName(g,"table");b=getClientRect(b);n=d.cell;m=getClientRect(n);d={left:m.left-b.left,right:m.right-b.left};n=n.childNodes;p=[];for(b=n.length-1;0<=b;b--){k=n[b];if(3==k.nodeType&&/./.test(k.nodeValue)){var q=document.createElement("span");q.setAttribute("raon_temp_node","1");k.parentNode.insertBefore(q,k);q.appendChild(k);checkChild=q}q=getClientRect(k);if(0<q.bottom)if(q.height<m.height&&q.bottom>
m.bottom)k.getAttribute("raon_temp_node")&&(k=k.firstChild),p.push(k.cloneNode(!0)),k.parentNode.removeChild(k);else break}0<p.length&&a.push({rect:d,childArr:p})}e=f.length;m=e-h;n=c.rows;f=null;for(e=0;e<m;e++){d=n[e];f=c.rows[d.rowIndex+1];if("collapse"!=d.style.visibility)for(p=d.cells,k=p.length,b=0;b<k;b++)if(q=p[b],1<q.rowSpan){g=null;for(h=0;h<k;h++)if(r=p[h],1==r.rowSpan&&null==r.getAttribute("raon_changed")){g=r;q.style.height=parseFloat(q.style.height)-parseFloat(r.style.height)+"px";break}null==
g&&(q.style.height=parseFloat(q.style.height)/q.rowSpan*(q.rowSpan-1)+"px");for(var u=q.cloneNode(!1),t=q.getBoundingClientRect(),v=n[d.rowIndex+1],w=v.cells,x=w.length,g=null,h=0;h<x;h++)if(r=w[h],l=r.getBoundingClientRect(),t.right<=l.left){g=r;break}q.rowSpan=1;q.setAttribute("raon_changed","1");--u.rowSpan;g?v.insertBefore(u,g):v.appendChild(u)}d.style.visibility="collapse"}if(0<a.length&&f)for(h=0;h<a.length;h++){c=a[h].rect;e=GetParentbyTagName(f,"table");b=getClientRect(e);g=null;for(e=0;e<
f.cells.length;e++)if(r=f.cells[e],l=getClientRect(r),d={left:l.left-b.left,right:l.right-b.left},isSameRect(d.left,c.left)&&isSameRect(d.right,c.right)){g=r;break}if(g)for(c=a[h].childArr,e=c.length-1;0<=e;e--)g.appendChild(c[e])}}else d.style.visibility="collapse"}}};this.afterSplitNode=function(){for(_name in this.modifyNodes)1==this.modifyNodes[_name].checked&&(this.modifyNodes[_name].modify&&this.modifyNodes[_name].modify(this),this.modifyNodes[_name].checked=!1)};this.addNodeToPage=function(a){if(1==
a.nodeType)for(;;)if(RegExp("<.*?break-after:\\s{0,}page[^>]*>","gi").test(a.outerHTML)&&this.util.isCheckPagebreaContainer(a.tagName)){this.initSplitConfig();var b=this.pageDocument.createElement("pagebreak");if(a.parentNode)if(this.util.insertAfter(a,b),this.util.isPageBreakNode(a))a.parentNode.removeChild(a),a=this.pageDocument.body.firstChild;else for(this.splitNode(a,b,{pageBreak:!0,forceStop:!1});b.lastChild;)this.util.insertAfter(b,b.lastChild);else break}else break;"PAGEBREAK"==a.tagName?
(this.createPage(),a.parentNode.removeChild(a)):(b=this.getCurrentPage(),b.appendChild(a),this.util.isActiveScrollbarY(b)&&(this.createPage(),this.initSplitConfig(),this.splitNode(a,this.pageDocument.body,{pageBreak:!1}),this.afterSplitNode()))};this.adjustNodeBeforeSplit=function(){for(var a=this.pageDocument,b=a.getElementsByTagName("p"),c=b.length,c=c-1;0<=c;c--){var d=b[c],f=d.getElementsByTagName("br");if(10<f.length)for(var e=parseInt(f.length/10)-1;0<=e;e--){var h=f[10*e];if(h){var l=d.cloneNode(!1),
g=a.createRange();g.setStartBefore(h);g.setEndAfter(d.lastChild);h=g.extractContents();l.appendChild(h);this.util.insertAfter(d,l)}}}b=a.getElementsByTagName("p");c=b.length;for(--c;0<=c;c--)if(d=b[c],f=d.getElementsByTagName("img"),e=f.length,1<e)for(--e;1<=e;e--)h=f[e],g=f[e-1],l=getClientRect(h),g=getClientRect(g),0==isSameRect(l.bottom,g.bottom)&&(l=d.cloneNode(!1),g=a.createRange(),g.setStartBefore(h),g.setEndAfter(d.lastChild),h=g.extractContents(),l.appendChild(h),this.util.insertAfter(d,l))};
this.checkAndMakePage=function(){try{0==!!this.getCurrentPage()&&(this.createPage(),this.getCurrentPage());for(;this.pageDocument.body.firstChild;)this.addNodeToPage(this.pageDocument.body.firstChild);this.onComplete()}catch(a){this.onComplete(a)}};this.setPdfStyle=function(a){var b;b=".raon_pdf_page {background: white;overflow-y: auto;";b+="overflow-x: hidden;";b+="box-sizing: border-box;";b+="{0}";b+="{1}";b+="}";var c=a.defaultStyle.fontSize,d=a.defaultStyle.lineHeight,f=a.defaultStyle.fontFamily,
e="",h=a.defaultStyle.wordBreak,l=a.defaultStyle.wordWrap,g=this.util.getPageSize(a.pageSize);""!=a.defaultStyle.editorBodyWidth?(g.width=a.defaultStyle.editorBodyWidth,e=a.defaultStyle.paddingTop+" 0px "+a.defaultStyle.paddingBottom+" 0px"):e=a.defaultStyle.paddingTop+" "+a.defaultStyle.paddingRight+" "+a.defaultStyle.paddingBottom+" "+a.defaultStyle.paddingLeft;a="";for(prop in g)a+=prop+": "+g[prop]+";";b=b.replace("{0}",a);"normal"==h&&"normal"==l&&(h="break-all",l="break-word");b=b.replace("{1}",
"padding: "+e+"; font-size: "+c+"; line-height: "+d+"; font-family: "+f+"; word-break: "+h+"; word-wrap: "+l+";");e=".raon_pdf_page p {"+("margin-top: 0px; margin-bottom: 0px; line-height: "+d+"; font-family: "+f+"; font-size: "+c+";")+"}";c=".raon_pdf_page li {"+("margin-top: 0px; margin-bottom: 0px; line-height: "+d+"; font-family: "+f+"; font-size: "+c+";")+"}";b=b+e+c;this.pdfStyle=document.createElement("style");this.pdfStyle.innerHTML=b;this.splitPageDocument.getElementsByTagName("head")[0].appendChild(this.pdfStyle)};
this.imageConvertBase64=function(a,b){for(var c=this.pageDocument.getElementsByTagName("img"),d=c.length,f=0;f<d;f++){var e=c[f];""==e.style.width&&(e.style.width=e.width+"px");""==e.style.height&&(e.style.height=e.height+"px");var h=this.util.getPageSize(a.pageSize),l=parseFloat(a.defaultStyle.paddingTop),g=parseFloat(a.defaultStyle.paddingBottom),h=parseFloat(h.height);e.height>h-l-g&&(e.style.height=h-l-g-10+"px")}b()};this.removeNodes=function(){for(var a=["script"],b=0;b<a.length;b++)for(var c=
this.pageDocument.getElementsByTagName(a[b]),d=c.length-1;0<=d;d--){var f=c[d];f.parentNode.removeChild(f)}}}SplitPage.prototype.start=function(a,b){this.onComplete=b;this.defaultStyle=a.defaultStyle;this.logging=a.logging;this.currentPageSize=this.util.getPageSize(a.pageSize);this.init(a)};
