(function(){try{var b={pluginName:"convertpdf",pluginFullName:"p_convertpdf"};G_KPlugin.convertpdf=b;b.isSupportBrowser=!0;"0"!=KEDITORTOP.G_CURRKEDITOR._config.useKManager||!KEDITORTOP.RAONKEDITOR.browser.ie&&0!=KEDITORTOP.RAONKEDITOR.browser.canvasSupported||function(){b.isSupportBrowser=!1;KEDITORTOP.G_CURRKEDITOR._config.removeItem.push(b.pluginFullName);var a=KEDITORTOP.G_CURRKEDITOR._config.toolbarArr1.indexOf(b.pluginFullName),c=KEDITORTOP.G_CURRKEDITOR._config.toolbarArr2.indexOf(b.pluginFullName);
-1<a&&KEDITORTOP.G_CURRKEDITOR._config.toolbarArr1.splice(a,1);-1<c&&KEDITORTOP.G_CURRKEDITOR._config.toolbarArr1.splice(c,1)}();b.onClickToolIcon=function(a){if(b.isSupportBrowser)switch(a){case b.pluginName:b.start()}};b.onDisableToolIcon=function(a){switch(a){case "":case "default":return!1;case "selectedMultiCell":return[b.pluginFullName];case "focusInCell":return!1;case "focusInCellLockTable":return!1;default:return[b.pluginFullName]}};b.onInit=function(){if(b.isSupportBrowser){var a=function(){d("../plugin/convertpdf/js"+
(KEDITORTOP.RAONKEDITOR.isRelease?"":"_dev")+"/jspdf.umd.min.js?t="+KEDITORTOP.RAONKEDITOR.UrlStamp);d("../plugin/convertpdf/js"+(KEDITORTOP.RAONKEDITOR.isRelease?"":"_dev")+(KEDITORTOP.RAONKEDITOR.isRelease?"/splitpage.min.js":"/splitpage.js")+"?t="+KEDITORTOP.RAONKEDITOR.UrlStamp);c()},c=function(){var a="../plugin/convertpdf/js"+(KEDITORTOP.RAONKEDITOR.isRelease?"":"_dev")+"/config.js",a="1"==KEDITORTOP.G_CURRKEDITOR._config.useConfigTimeStamp?a+("?t="+KEDITORTOP.RAONKEDITOR.util.getTimeStamp()):
a+("?t="+KEDITORTOP.RAONKEDITOR.UrlStamp);d(a)};"1"==KEDITORTOP.G_CURRKEDITOR._config.useKManager?c():0==KEDITORTOP.RAONKEDITOR.browser.ES6Supported?d("../plugin/convertpdf/js"+(KEDITORTOP.RAONKEDITOR.isRelease?"":"_dev")+"/polyfills.umd.js?t="+KEDITORTOP.RAONKEDITOR.UrlStamp,function(){a()}):a()}};var d=function(a,b){var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.type="text/javascript";b&&(f.onload=function(){b(!0)},f.onerror=function(){b(!1)});f.src=a;e.appendChild(f)};
b.onInit();b.onLoaded=function(){var a=document.getElementById("ue_"+KEDITORTOP.G_CURRKEDITOR.ID+b.pluginFullName);a&&a.setAttribute("title",b.lang.icon[b.pluginFullName])};b.start=function(){KEDITORTOP.RAONKEDITOR.isEmpty(KEDITORTOP.G_CURRKEDITOR.ID)?alert(b.lang.message.empty):"1"==KEDITORTOP.G_CURRKEDITOR._config.useKManager&&0==KEDITORTOP.G_CURRKEDITOR.isSupportedAgentPdf?alert(b.lang.message.agentPdfNotSupported):(showProcessingBackground(),KEDITORTOP.RAONKEDITOR.GetHtmlContents({type:"htmlexwithdoctype",
callback:function(a){a=a.strData;if("1"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){var c="<style>@media print { {0} }</style>",c=""!=_iframeDoc.body.style.width?c.replace("{0}","@page { size: A4; margin: 0 auto; }"):c.replace("{0}","@page { margin: 0; }");-1<a.toLowerCase().indexOf("</head>")&&(a=a.replace("</head>",c+"</head>"));agentSaveFile(KEDITORTOP.G_CURRKEDITOR,b.options.fileName,a,function(a){hideProcessingBackground()},!1,{convertPdf:!0})}else{c=KEDITORTOP.RAONKEDITOR.util.getStyle(_iframeDoc.body,
"all");a={html:a,pageSize:"a4",defaultStyle:{fontSize:KEDITORTOP.G_CURRKEDITOR._setting.font_size,fontFamily:KEDITORTOP.G_CURRKEDITOR._setting.font_family,paddingTop:c.marginTop,paddingBottom:c.marginBottom,paddingLeft:c.marginLeft,paddingRight:c.marginRight,lineHeight:KEDITORTOP.G_CURRKEDITOR._setting.line_height,editorBodyWidth:_iframeDoc.body.style.width,wordBreak:c.wordBreak,wordWrap:c.wordWrap}};var e=new SplitPage;e.start(a,function(a){if(a)console.log(a),alert(b.lang.message.error),hideProcessingBackground();
else{var c={pages:e.page,pageToImageIndex:0,canvas:[],imgData:[],splitPageWindow:e.splitPageWindow};a=e.splitPageDocument.createElement("script");a.onload=function(){b.pageToImage(c,function(a){for(var c=new jspdf.jsPDF("p","cm","a4"),f=a.length,d=0;d<f;d++){0<d&&c.addPage();var h=a[d],g=c.internal.pageSize.getWidth()+"cm",g=KEDITORTOP.RAONKEDITOR.util.replacePtOrCmToPx(g),g=parseFloat(g),g=(g-h.width)/2,g=.02645*g,h=h.toDataURL("image/png");c.addImage(h,"PNG",g,0)}c.save(b.options.fileName);e.clear();
hideProcessingBackground()})};a.onerror=function(){};a.src="../plugin/convertpdf/js"+(KEDITORTOP.RAONKEDITOR.isRelease?"":"_dev")+"/html2canvas.min.js?t="+KEDITORTOP.RAONKEDITOR.UrlStamp;e.splitPageDocument.getElementsByTagName("head")[0].appendChild(a)}})}}},KEDITORTOP.RAONKEDITOR.ID))};b.pageToImage=function(a,c){var e=a.pages,f=a.canvas;a.splitPageWindow.html2canvas(e[a.pageToImageIndex],{allowTaint:!0,useCORS:!0,logging:!1}).then(function(d){f.push(d);a.pageToImageIndex++;e[a.pageToImageIndex]?
b.pageToImage(a,c):c(f)})}}catch(k){KEDITORTOP&&KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&window&&window.console&&console.log(k)}})();
