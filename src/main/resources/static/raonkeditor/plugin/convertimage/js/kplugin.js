(function(){try{var b={pluginName:"convertimage",pluginFullName:"p_convertimage"};G_KPlugin.convertimage=b;b.isSupportBrowser=!0;0!=KEDITORTOP.RAONKEDITOR.browser.canvasSupported&&"function"==typeof window.Uint16Array||function(){b.isSupportBrowser=!1;KEDITORTOP.G_CURRKEDITOR._config.removeItem.push(b.pluginFullName);var a=KEDITORTOP.G_CURRKEDITOR._config.toolbarArr1.indexOf(b.pluginFullName),d=KEDITORTOP.G_CURRKEDITOR._config.toolbarArr2.indexOf(b.pluginFullName);-1<a&&KEDITORTOP.G_CURRKEDITOR._config.toolbarArr1.splice(a,
1);-1<d&&KEDITORTOP.G_CURRKEDITOR._config.toolbarArr1.splice(d,1)}();b.onClickToolIcon=function(a){if(b.isSupportBrowser)switch(a){case b.pluginName:b.start()}};b.onDisableToolIcon=function(a){switch(a){case "":case "default":return!1;case "selectedMultiCell":return[b.pluginFullName];case "focusInCell":return!1;case "focusInCellLockTable":return!1;default:return[b.pluginFullName]}};b.onInit=function(){if(b.isSupportBrowser){var a="../plugin/"+b.pluginName+"/js"+(KEDITORTOP.RAONKEDITOR.isRelease?"":
"_dev")+"/config.js",a="1"==KEDITORTOP.G_CURRKEDITOR._config.useConfigTimeStamp?a+("?t="+KEDITORTOP.RAONKEDITOR.util.getTimeStamp()):a+("?t="+KEDITORTOP.RAONKEDITOR.UrlStamp);m(a)}};var m=function(b,d){var k=document.getElementsByTagName("head")[0],c=document.createElement("script");c.type="text/javascript";d&&(c.onload=function(){d(!0)},c.onerror=function(){d(!1)});c.src=b;k.appendChild(c)};b.onInit();b.onLoaded=function(){var a=document.getElementById("ue_"+KEDITORTOP.G_CURRKEDITOR.ID+b.pluginFullName);
a&&a.setAttribute("title",b.lang.icon[b.pluginFullName])};b.start=function(){KEDITORTOP.RAONKEDITOR.isEmpty(KEDITORTOP.G_CURRKEDITOR.ID)?alert(b.lang.message.empty):(showProcessingBackground(),KEDITORTOP.RAONKEDITOR.GetHtmlContents({type:"htmlexwithdoctype",callback:function(a){a=a.strData;var d=document.createElement("iframe");document.body.appendChild(d);d.style.opacity=0;d.style.position="absolute";d.style.width="100%";var k=d.contentWindow,c=k.document,l=function(){var a=c.createElement("script");
a.onload=function(){var a={allowTaint:!0,useCORS:!0,logging:!1},e=document.getElementById("ue_editor_holder_"+KEDITORTOP.G_CURRKEDITOR.ID).style.height,e=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(e);"number"==typeof e&&0<e&&getClientRect(c.body).bottom<e&&(a.height=e);e=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(c.body.style.width);if(0<e){var f=KEDITORTOP.RAONKEDITOR.util.getStyle(c.body,"all"),h=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(f.marginLeft),h=KEDITORTOP.RAONKEDITOR.util.replacePtOrCmToPx(h),
h=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(h),f=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(f.marginRight),f=KEDITORTOP.RAONKEDITOR.util.replacePtOrCmToPx(f),f=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(f);a.width=e+h+f}k.html2canvas(c.body,a).then(function(a){var e=b.options.extension;void 0!==KEDITORTOP.G_CURRKEDITOR.strSavedExtension&&""!==KEDITORTOP.G_CURRKEDITOR.strSavedExtension&&(e=KEDITORTOP.G_CURRKEDITOR.strSavedExtension,KEDITORTOP.G_CURRKEDITOR.strSavedExtension="");var f=b.options.fileName+"."+
e;a=a.toDataURL("png"==e?"image/png":"jpg"==e?"image/jpeg":"image/webp");if(KEDITORTOP.RAONKEDITOR.browser.ie)KEDITORTOP.navigator.msSaveOrOpenBlob?(a=KEDITORTOP.RAONKEDITOR.util.dataURItoBlob(a),KEDITORTOP.navigator.msSaveOrOpenBlob(a,f),a=null):alert(b.lang.message.error);else{var g=document.createElement("a");g.position="absolute";document.body.appendChild(g);g.href=a;g.target="_self";g.download=f;g.click();setTimeout(function(){try{g.parentNode.removeChild(g),g=null,g=void 0}catch(a){KEDITORTOP&&
KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&window&&window.console&&console.log(a)}},100)}hideProcessingBackground();setTimeout(function(){try{c.body.innerHTML="",d.parentNode.removeChild(d),d=null,d=void 0}catch(a){KEDITORTOP&&KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&window&&window.console&&console.log(a)}},100)})};a.onerror=function(a){alert(b.lang.message.error+"\n(script not loaded)");hideProcessingBackground()};a.src=KEDITORTOP.G_CURRKEDITOR._config.webPath.plugin+
b.pluginName+"/js"+(KEDITORTOP.RAONKEDITOR.isRelease?"":"_dev")+"/html2canvas.min.js?t="+KEDITORTOP.RAONKEDITOR.UrlStamp;c.getElementsByTagName("head")[0].appendChild(a)};window.convertIframeLoaded=function(){delete window.convertIframeLoaded;if(0==KEDITORTOP.RAONKEDITOR.browser.ES6Supported){var a=c.createElement("script");a.onload=function(){l()};a.onerror=function(a){alert(b.lang.message.error+"\n(script not loaded)");hideProcessingBackground()};a.src=KEDITORTOP.G_CURRKEDITOR._config.webPath.plugin+
b.pluginName+"/js"+(KEDITORTOP.RAONKEDITOR.isRelease?"":"_dev")+"/polyfills.umd.js?t="+KEDITORTOP.RAONKEDITOR.UrlStamp;c.getElementsByTagName("head")[0].appendChild(a)}else l()};c.open();c.write(a+'<script type="text/javascript">document.body.onload = function() { parent.convertIframeLoaded(); }\x3c/script>');c.close()}},KEDITORTOP.RAONKEDITOR.ID))}}catch(n){KEDITORTOP&&KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&window&&window.console&&console.log(n)}})();
