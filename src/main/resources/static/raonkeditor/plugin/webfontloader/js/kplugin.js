(function(){try{var a={pluginName:"webfontloader"};G_KPlugin.webfontloader=a;var g="",h="";a.onInit=function(){g="../plugin/webfontloader/js"+(KEDITORTOP.RAONKEDITOR.isRelease?"":"_dev")+"/config.js";h="../plugin/webfontloader/js"+(KEDITORTOP.RAONKEDITOR.isRelease?"":"_dev")+"/webfont.js";"1"==KEDITORTOP.G_CURRKEDITOR._config.useConfigTimeStamp?(g+="?t="+KEDITORTOP.RAONKEDITOR.util.getTimeStamp(),h+="?t="+KEDITORTOP.RAONKEDITOR.util.getTimeStamp()):(g+="?t="+KEDITORTOP.RAONKEDITOR.UrlStamp,h+="?t="+
KEDITORTOP.RAONKEDITOR.UrlStamp);r(g,a.configLoaded)};var r=function(a,b){var d=document.getElementsByTagName("head")[0],f=document.createElement("script");f.type="text/javascript";f.src=a;f.onload=b;d.appendChild(f)};a.onLoaded=function(){KEDITORTOP.RAONKEDITOR.browser.ie?(a.config.uselocalstorage="0",a.loadWebFontCss(_iframeWin)):(KEDITORTOP.RAONKEDITOR.browser.LocalStorageSupported&&a.config.uselocalstorage||(a.config.uselocalstorage="0"),r(h,a.webfontLoaded))};a.configLoaded=function(){};a.webfontLoaded=
function(){"0"==a.config.uselocalstorage?a.loadWebFontCss(_iframeWin):a.loadWebFontFromLocalStorage(_iframeWin)};a.loadWebFontCss=function(l){if("1"!=a.config.uselocalstorage){for(var b=a.config.timeout,b=""==b||0>=parseInt(b)?3E3:parseInt(b),d=a.config.fonts,f=d.length,n=[],c=[],e=0;e<f;e++)""!=d[e].fontCssUrl&&(n=n.concat(d[e].fontFamilies),-1==c.indexOf(d[e].fontCssUrl)&&c.push(d[e].fontCssUrl));d=l.document;f=d.getElementsByTagName("link");for(e=f.length-1;0<=e;e--){for(var p=f[e],g=p.href,k=
!1,h=c.length,q=0;q<h;q++)if(-1<g.indexOf(c[q])){k=!0;break}k&&p.parentNode.removeChild(p)}if(KEDITORTOP.RAONKEDITOR.browser.ie){if(l=0<d.getElementsByTagName("head").length?d.getElementsByTagName("head")[0]:null)for(e=0;e<c.length;e++)createDynamicCssLinkToHeadTag(d,l,c[e])}else WebFont.load({custom:{families:n,urls:c},context:l,classes:!1,timeout:b})}};a.onAfterDocumentWrite=function(l){switch(l){case "SetHtmlValue":case "SetHtmlValueEx":case "SetHtmlValueExWithDocType":"0"==a.config.uselocalstorage?
a.loadWebFontCss(_iframeWin):a.loadWebFontFromLocalStorage(_iframeWin)}};a.loadWebFontFromLocalStorage=function(l){for(var b=a.config.fonts,d=b.length,f=l.document,g=0<f.getElementsByTagName("head").length?f.getElementsByTagName("head")[0]:null,c=0;c<d;c++)if(1<b[c].fontFamilies.length){for(var e=[],h=[],c=0;c<d;c++)""!=b[c].fontCssUrl&&(e=e.concat(b[c].fontFamilies),-1==h.indexOf(b[c].fontCssUrl)&&h.push(b[c].fontCssUrl));WebFont.load({custom:{families:e,urls:h},context:l,classes:!1,timeout:a.config.timeout})}else{var m=
b[c].fontFamilies[0];if(a.isFileSaved(m,b[c].fontCssUrl))a.injectRawStyle(g,localStorage["RAONK_WEBFONT_"+m]);else{var k=new XMLHttpRequest;k.open("GET",b[c].fontCssUrl,!1);k.onreadystatechange=function(){4===k.readyState&&(-1<k.responseText.indexOf("data:application/font")||-1<k.responseText.indexOf("data:application/octet-stream")?(a.injectRawStyle(g,k.responseText),localStorage["RAONK_WEBFONT_"+m]=k.responseText,localStorage["RAONK_WEBFONT_"+m+"_URL"]=b[c].fontCssUrl):createDynamicCssLinkToHeadTag(f,
g,b[c].fontCssUrl))};k.send()}}};a.injectRawStyle=function(a,b){var d=document.createElement("style");d.setAttribute("type","text/css");d.setAttribute("RAONK_WEBFONT_BASE64","true");d.styleSheet?d.styleSheet.cssText=b:d.innerHTML=b;a.appendChild(d)};a.isFileSaved=function(a,b){return window.localStorage&&localStorage["RAONK_WEBFONT_"+a]&&localStorage["RAONK_WEBFONT_"+a+"_URL"]===b};a.removeBase64WebFontFromHead=function(a){a&&(a=a.replace(/<style type="text\/css" raonk_webfont_base64="true"[^>]*>[^<]*<\/style>/g,
""));return a};a.onInit()}catch(t){KEDITORTOP&&KEDITORTOP.RAONKEDITOR&&KEDITORTOP.RAONKEDITOR.logMode&&window&&window.console&&console.log(t)}})();
